(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"sg+I":function(e,t,n){},tjUo:function(e,t,n){"use strict";n.r(t);n("sg+I"),n("pNMO"),n("TeQF"),n("QWBl"),n("pjDv"),n("4mDm"),n("2B1R"),n("ToJy"),n("sMBO"),n("Tskq"),n("5DmW"),n("27RR"),n("tkto"),n("07d7"),n("PKPk"),n("wgYD"),n("R3/m"),n("l/vG"),n("0q/z"),n("n5pg"),n("Q7Pz"),n("Vnov"),n("nIe3"),n("CUyW"),n("qc1c"),n("VOz1"),n("Thag"),n("9D6x"),n("FZtP"),n("3bBZ");var o,i=n("QILm"),r=n.n(i),a=n("lwsE"),s=n.n(a),c=n("W8MJ"),l=n.n(c),p=n("lSNA"),u=n.n(p),d=(o=d3).dispatch.apply(o,["fetch-map-data-resolve","fetch-map-data-reject","viewport-size","render-infowindow","close-infowindow","title-details-toggle","title-details-close","title-details-open","show-loading-indicator","hide-loading-indicator"]),m=(n("ma9I"),"public.emergency_tenant_protections_scored"),f="\nSELECT\n  municipality, state, country, range, \n  policy_type, policy_summary, link, the_geom\nFROM ".concat(m,"\nWHERE the_geom is not null and admin_scale = 'City'\nORDER BY range"),y="\nSELECT\n  c.the_geom, c.county, c.state, m.range, \n  m.policy_type, m.policy_summary, m.link, m.range\nFROM ".concat("public.us_county_boundaries"," c\nJOIN ").concat(m," m\nON ST_Intersects(c.the_geom, m.the_geom)\nWHERE m.the_geom IS NOT NULL\n  AND m.admin_scale = 'County'\n  OR m.admin_scale = 'City and County'\nORDER BY m.range"),h="\nSELECT\n  s.the_geom, s.name, s.admin, s.sr_adm0_a3,\n  m.range, m.iso, m .policy_type, m.policy_summary, m.link\nFROM ".concat("public.states_and_provinces_global"," s\nINNER JOIN ").concat(m," m\n  ON s.name = m.state\n  AND s.sr_adm0_a3 = m.iso\n  AND m.admin_scale = 'State'\nORDER BY m.range"),g="\nSELECT \n  c.the_geom, c.adm0_a3, c.name_en, m.range,\n  m.policy_type, m.policy_summary, m.link\nFROM ".concat("public.countries"," c\nINNER JOIN ").concat(m," m\n  ON c.adm0_a3 = m.iso\n  AND m.admin_scale = 'Country'\nORDER BY m.range");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=new L.Icon({iconUrl:"./assets/mapIcons/rent-strike.svg",iconSize:[40,40],iconAnchor:[20,20],className:"icon-rent-strike"}),k={cities:{name:"Cities",type:"point",query:f,zIndex:1,props:function(e){var t=e.feature.properties,n=t.municipality,o=t.state,i=t.country;return b(b({},e.feature.properties),{},{jurisdictionName:"".concat(n).concat(o?", ".concat(o):"").concat(i?", ".concat(i):""),jurisdictionType:"City",popupName:n,policyStrength:_[e.feature.properties.range]})},style:function(e){return{color:I[e.properties.range]||O,fillColor:T[e.properties.range]||O,fillOpacity:S,radius:E,weight:C}},pointToLayer:function(e,t){return L.circleMarker(t,k.cities.style(e))}},counties:{name:"Counties",type:"polygon",query:y,zIndex:2,props:function(e){var t=e.feature.properties,n=t.state,o=t.county;return b(b({},e.feature.properties),{},{jurisdictionName:"".concat(o).concat(n?", ".concat(n):""),jurisdictionType:"County",popupName:"".concat(o).concat(n?", ".concat(n):""),policyStrength:_[e.feature.properties.range]})},style:function(e){return{color:I[e.properties.range]||O,fillColor:T[e.properties.range]||O,fillOpacity:S,radius:E,weight:C}}},states:{name:"States",type:"polygon",query:h,zIndex:3,props:function(e){var t=e.feature.properties,n=t.name,o=t.admin;return b(b(b({},e.feature.properties),e.feature.properties),{},{jurisdictionName:"".concat(n).concat(o?", ".concat(o):""),jurisdictionType:"State/Province",popupName:n,policyStrength:_[e.feature.properties.range]})},style:function(e){return{color:I[e.properties.range]||O,fillColor:T[e.properties.range]||O,fillOpacity:S,radius:E,weight:C}}},nations:{name:"Nations",type:"polygon",query:g,zIndex:4,props:function(e){var t=e.feature.properties.name_en;return b(b({},e.feature.properties),{},{jurisdictionName:t,jurisdictionType:"Country",popupName:t,policyStrength:_[e.feature.properties.range]})},style:function(e){return{color:I[e.properties.range]||O,fillColor:T[e.properties.range]||O,fillOpacity:S,radius:E,weight:C}}},rentStrikes:{name:"Rent Strikes",type:"marker-cluster",query:null,sheetId:"1rCZfNXO3gbl5H3cKhGXKIv3samJ1KC4nLhCwwZqrHvU",zIndex:0,props:function(e){return e.feature.properties},pointToLayer:function(e,t){return L.marker(t,{icon:v})}}};window.mapLayersConfig=k;var O="#939393",T=[void 0,"#d9f0a3","#78c679","#238443"],I=[void 0,"#addd8e","#41ab5d","#005a32"],C=1.5,E=8,S=.7,_=["","Few protections in place","Some protections in place","Many protections in place"],j={lat:40.67,lng:-97.23,z:4,nations:!1,states:!0,cities:!0,counties:!0,rentStrikes:!0},x=Object.keys(k).length,D=function(){return document.querySelector("body").offsetWidth<640};function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var z=function(){function e(t){var n=this;s()(this,e),u()(this,"dataLayers",new Map),u()(this,"popupTemplate",document.querySelector(".popup-template").innerHTML),u()(this,"rentStrikePopupTemplate",document.querySelector(".rentstrike-popup-template").innerHTML),u()(this,"handleWindowResize",(function(){D()&&n.map.invalidateSize()})),u()(this,"handleInfoWindowClose",(function(){n.map.closePopup(),D()&&n.map.invalidateSize()})),u()(this,"handleAddLayerError",(function(e){console.error(e),n.toggleLoadingIndicator(!1)})),u()(this,"handleAddLayer",(function(e){var t,o,i,a,s=e.key,c=e.layerConfig,l=e.data,p=n;switch(c.type){case"point":t=L.geoJson(l,{pointToLayer:c.pointToLayer});break;case"polygon":t=L.geoJson(l,{style:function(e){return c.style(e)}});break;case"marker-cluster":o={type:"FeatureCollection",features:l.filter((function(e){var t=e.Strike_Status,n=e.Latitude,o=e.Longitude;return null!==t&&null!==o&&null!==n})).map((function(e){var t=e.Strike_Status;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({status:"Yes / Sí / 是 / Oui"===t||"Yes"===t?"Yes":"Unsure"},r()(e,["Strike_Status"]))})).map((function(e,t){var n=e.Longitude,o=e.Latitude;return{type:"Feature",id:t,properties:r()(e,["Longitude","Latitude"]),geometry:{type:"Point",coordinates:[n,o]}}}))},i=L.geoJson(o,{pointToLayer:c.pointToLayer}),(a=L.markerClusterGroup({maxClusterRadius:40}).on("clusterclick",(function(){D()&&d.call("title-details-close")}))).addLayer(i).bindPopup((function(e){return d.call("render-infowindow",null,{template:"rentstrikes",data:e.feature.properties}),Mustache.render(p.rentStrikePopupTemplate,c.props(e))})),t=a;break;default:throw Error("Unrecognized map layer type")}"marker-cluster"!==c.type&&t.bindPopup((function(e){var t=c.props(e);return d.call("render-infowindow",null,{template:"protections",data:t}),Mustache.render(p.popupTemplate,t)})),n.dataLayers.set(c.name,{layerGroup:t,zIndex:c.zIndex}),n.config[s]&&t.addTo(n.map),n.fixZOrder(),n.handleAllLayersAdded()})),u()(this,"handleAllLayersAdded",(function(){n.dataLayers.size===x&&(n.dataLayers.forEach((function(e,t){var o=e.layerGroup;n.layersControl.addOverlay(o,t)})),n.toggleLoadingIndicator(!1))})),u()(this,"fixZOrder",(function(){Array.from(n.dataLayers.values()).sort((function(e,t){return t.zIndex-e.zIndex})).forEach((function(e){var t=e.layerGroup;n.map.hasLayer(t)&&t.bringToFront()}))})),u()(this,"toggleLoadingIndicator",(function(e){e?d.call("show-loading-indicator"):d.call("hide-loading-indicator")})),this.config=t||j,this.init(),this.bindListeners()}return l()(e,[{key:"init",value:function(){var e=this.config,t=e.lat,n=e.lng,o=e.z;this.map=L.map("map",{zoomControl:!1,attributionControl:!1,maxBounds:[[-85.05,-190],[85.05,200]]}),this.map.setView([t,n],o),this.attributionControl=L.control.attribution({prefix:"Data sources by: "}).addAttribution("<a href='https://www.antievictionmap.com/' target='_blank'>Anti-Eviction Mapping Project</a>").addAttribution("<a href='https://www.openstreetmap.org' target='_blank'>Open Street Map Contributors</a>").addTo(this.map),this.zoomControl=L.control.zoom({position:"bottomright"}).addTo(this.map),this.layersControl=L.control.layers(null,null,{position:"topright",collapsed:!1}).addTo(this.map),this.basemapLayer=L.tileLayer("https://a.basemaps.cartocdn.com/rastertiles/light_all/{z}/{x}/{y}@2x.png",{minZoom:1,maxZoom:18}).addTo(this.map)}},{key:"bindListeners",value:function(){var e,t=this,n=this;this.map.on("popupopen",(function(e){document.getElementById("root").classList.add("aemp-popupopen"),D()&&(d.call("title-details-close"),n.map.invalidateSize()),n.map.setView(e.popup._latlng,n.map.getZoom(),{animate:!0})})),this.map.on("popupclose",(function(){document.getElementById("root").classList.remove("aemp-popupopen"),d.call("close-infowindow"),D()&&setTimeout((function(){n.map.invalidateSize()}),100)})),this.map.on("click",(function(){D()&&d.call("title-details-close")})),this.map.on("overlayadd",(function(){t.fixZOrder()})),window.addEventListener("resize",(function(){clearTimeout(e),e=setTimeout(n.handleWindowResize,250)})),d.on("close-infowindow.map",this.handleInfoWindowClose),d.on("fetch-map-data-resolve.map",this.handleAddLayer),d.on("fetch-map-data-reject.map",this.handleLayerError)}}]),e}(),P=function(){function e(){var t=this;s()(this,e),u()(this,"infowindowContainer",document.getElementById("aemp-infowindow-container")),u()(this,"infowindowTemplate",document.getElementById("aemp-infowindow-template").innerHTML),u()(this,"rentStrikeInfowindowTemplate",document.getElementById("aemp-rentstrike-infowindow-template").innerHTML),u()(this,"closeInfoWindow",(function(){document.getElementById("root").classList.remove("aemp-popupopen"),t.infowindowContainer.innerHTML=null})),u()(this,"render",(function(e){var n=e.template,o=e.data;switch(n){case"protections":t.infowindowContainer.innerHTML=Mustache.render(t.infowindowTemplate,o);break;case"rentstrikes":t.infowindowContainer.innerHTML=Mustache.render(t.rentStrikeInfowindowTemplate,o)}t.infowindowContainer.querySelector(".aemp-infowindow-close").addEventListener("click",(function(){return d.call("close-infowindow")})),document.getElementById("root").classList.add("aemp-popupopen")})),this.bindListeners()}return l()(e,[{key:"bindListeners",value:function(){d.on("render-infowindow",this.render),d.on("close-infowindow.self",this.closeInfoWindow)}}]),e}(),R=function(){function e(){var t=this;s()(this,e),u()(this,"loadingContainer",document.getElementById("loading-container")),u()(this,"show",(function(){t.loadingContainer.hidden=!1})),u()(this,"hide",(function(){t.loadingContainer.hidden=!0})),this.bindListeners()}return l()(e,[{key:"bindListeners",value:function(){d.on("show-loading-indicator",this.show),d.on("hide-loading-indicator",this.hide)}}]),e}(),M=(n("T63A"),n("5s+n"),n("J4zp")),B=n.n(M),q=n("o0o1"),A=n.n(q),W=(n("ls82"),n("yXPU")),F=n.n(W),J="https://".concat("ampitup",".carto.com/api/v2/sql");function U(e,t){d.call(e,null,t)}function H(e,t){d.call(e,null,t)}function Z(e){return Y.apply(this,arguments)}function Y(){return(Y=F()(A.a.mark((function e(t){var n,o,i=arguments;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"geojson",e.next=3,fetch("".concat(J,"?q=").concat(window.encodeURIComponent(t),"&format=").concat(n));case 3:if((o=e.sent)&&o.ok){e.next=6;break}throw Error("Unable to fetch Carto data");case 6:return e.abrupt("return",o.json());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return K.apply(this,arguments)}function K(){return(K=F()(A.a.mark((function e(t){var n,o;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://docs.google.com/spreadsheets/d/".concat(t,"/export?format=csv&id=").concat(t));case 2:if((n=e.sent)&&n.ok){e.next=5;break}throw Error("Unable to fetch sheets data");case 5:return e.next=7,n.text();case 7:return o=e.sent,e.abrupt("return",d3.csvParse(o,d3.autoType));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return(Q=F()(A.a.mark((function e(){var t,n,o,i,r,a;return A.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=Object.entries(k);case 1:if(!(t<n.length)){e.next=23;break}if(o=B()(n[t],2),i=o[0],r=o[1],e.prev=3,null===r.query){e.next=10;break}return e.next=7,Z(r.query);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,G(r.sheetId);case 12:e.t0=e.sent;case 13:a=e.t0,U("fetch-map-data-resolve",{key:i,layerConfig:r,data:a}),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(3),H("fetch-map-data-reject",e.t1);case 20:t++,e.next=1;break;case 23:case"end":return e.stop()}}),e,null,[[3,17]])})))).apply(this,arguments)}n("+2oP"),n("rB9j"),n("EnZy");new z(function(e){for(var t=window.location.hash.slice(1).split("&"),n={},o=0;o<t.length;o++){var i=t[o].split("="),r=B()(i,2),a=r[0],s=r[1];n[a]=s}isNaN(n.z)||(e.z=parseInt(n.z)),isNaN(n.lat)||(e.lat=parseFloat(n.lat)),isNaN(n.lng)||(e.lng=parseFloat(n.lng)),void 0!==n.cities&&("true"===n.cities?e.cities=!0:"false"===n.cities&&(e.cities=!1)),void 0!==n.counties&&("true"===n.counties?e.counties=!0:"false"===n.counties&&(e.counties=!1)),void 0!==n.states&&("true"===n.states?e.states=!0:"false"===n.states&&(e.states=!1)),void 0!==n.nations&&("true"===n.nations?e.nations=!0:"false"===n.nations&&(e.nations=!1)),void 0!==n.rentstrike&&("true"===n.rentstrike?e.rentStrikes=!0:"false"===n.rentstrike&&(e.rentStrikes=!1))}(j)),new P,new function e(){var t=this;s()(this,e),u()(this,"titleDetails",document.getElementById("aemp-titlebox").querySelector("details")),u()(this,"bindListeners",(function(){t.titleDetails.addEventListener("toggle",(function(){this.open?document.getElementById("aemp-titlebox").classList.remove("collapsed"):document.getElementById("aemp-titlebox").classList.add("collapsed")})),d.on("title-details-toggle",t.toggleTitleDetails),d.on("title-details-open",t.openTitleDetails),d.on("title-details-close",t.closeTitleDetails)})),u()(this,"closeTitleDetails",(function(){t.titleDetails.open=!1})),u()(this,"openTitleDetails",(function(){t.titleDetails.open=!0})),u()(this,"toggleTitleDetails",(function(){t.titleDetails.open?t.titleDetails.open=!1:t.titleDetails.open=!0})),this.bindListeners()},new R,function(){Q.apply(this,arguments)}()}},[["tjUo",1,2]]]);
//# sourceMappingURL=index.a972445e87dedd25f7ac.js.map